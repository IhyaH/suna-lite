# 安全指南

## 🔐 安全最佳实践

### API密钥管理

#### 永远不要做的事情
- ❌ 不要将API密钥硬编码在代码中
- ❌ 不要将API密钥提交到版本控制系统
- ❌ 不要在不安全的地方存储API密钥
- ❌ 不要在日志或错误信息中输出API密钥

#### 推荐的做法
- ✅ 使用环境变量或配置文件
- ✅ 将配置文件添加到 `.gitignore`
- ✅ 使用配置模板文件（如 `config.yaml.example`）
- ✅ 定期轮换API密钥
- ✅ 为不同环境使用不同的API密钥

### 配置文件安全

项目使用以下配置文件策略：

```
config.yaml              # 实际配置文件（已忽略）
config.yaml.example     # 配置模板文件
config.local.yaml       # 本地开发配置（已忽略）
config.dev.yaml         # 开发环境配置（已忽略）
config.prod.yaml        # 生产环境配置（已忽略）
```

### 环境变量配置

```bash
# 方法1：直接设置环境变量
export OPENAI_API_KEY="your_api_key_here"
export TAVILY_API_KEY="your_tavily_api_key_here"

# 方法2：使用.env文件（开发环境）
echo "OPENAI_API_KEY=your_api_key_here" > .env
echo "TAVILY_API_KEY=your_tavily_api_key_here" >> .env
```

## 🛡️ 代码安全

### 输入验证
- 所有用户输入都必须经过验证和清理
- 使用白名单而不是黑名单进行验证
- 对文件路径进行严格验证，防止路径遍历攻击

### 权限控制
- 工作区操作限制在指定目录内
- Shell命令执行使用白名单过滤
- 文件系统访问权限最小化

### 错误处理
- 不要在错误信息中暴露敏感信息
- 使用通用错误消息代替详细错误
- 记录错误日志但不记录敏感数据

## 🔍 安全检查清单

### 开发前
- [ ] 检查代码中是否有硬编码的密钥
- [ ] 确认 `.gitignore` 包含所有敏感文件
- [ ] 验证配置文件不包含真实密钥
- [ ] 检查日志输出是否安全

### 提交前
- [ ] 运行 `git grep` 检查敏感信息
- [ ] 使用 `git diff` 检查更改内容
- [ ] 确认没有意外提交配置文件
- [ ] 验证测试文件不包含真实数据

### 部署前
- [ ] 更新所有API密钥
- [ ] 检查环境变量配置
- [ ] 验证权限设置
- [ ] 测试安全功能

## 🚨 安全事件响应

### 如果API密钥泄露
1. **立即撤销**泄露的API密钥
2. **生成新密钥**并更新配置
3. **检查使用情况**确认是否被恶意使用
4. **通知相关人员**采取必要措施
5. **审查安全流程**防止再次发生

### 如果发现安全漏洞
1. **立即修复**已知漏洞
2. **更新依赖包**到最新版本
3. **通知用户**升级到安全版本
4. **发布安全公告**说明漏洞详情
5. **加强监控**防止类似问题

## 📧 安全报告

如果你发现安全漏洞，请：
1. 通过私密渠道报告（邮件或私密Issue）
2. 提供详细的漏洞信息和复现步骤
3. 给予我们时间修复漏洞
4. 不要公开披露漏洞详情

**联系方式：** security@suna-lite.com

## 🔄 密钥轮换

建议定期轮换API密钥：
- **开发环境**：每3个月
- **生产环境**：每6个月
- **怀疑泄露时**：立即轮换

### 轮换步骤
1. 生成新API密钥
2. 更新配置文件
3. 测试新密钥是否正常工作
4. 撤销旧密钥
5. 监控系统运行状态

## 📊 安全监控

建议监控以下安全指标：
- API调用频率异常
- 失败的API请求
- 可疑的文件访问模式
- 异常的系统命令执行

---

**最后更新：** 2025-09-07
**版本：** 1.0

*请定期检查和更新此安全指南*